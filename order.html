<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="https://vampuser12.github.io/castle/images/logo/whites-castle-128.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>
    
    <link rel="stylesheet" href="style.css" />
    <script src="script.js"></script>
    <title>Whites Castle</title>
  </head>
  <body onload="myScript()" style="padding-top: 5em">
    <nav class="navbar navbar-expand-md fixed-top navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand ms-5 fw-bold fs-3" href="index.html">Whites Castle</a>
        <div class="d-flex">
          <a
            href="cart.html"
            class="btn btn-outline btn-light d-block d-md-none"
            ><i class="fa-shopping-cart fa"></i
            ><span class="badge rounded-pill bg-success d-none cart-count">
              3
              <span class="visually-hidden">number of cart</span>
            </span></a
          >
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarText"
            aria-controls="navbarText"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>
        <div class="collapse navbar-collapse" id="navbarText">
          <ul class="navbar-nav mb-2 mb-lg-0 ms-auto fs-5 me-5">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarScrollingDropdown"
                role="button"
                data-bs-toggle="dropdown"
                data-bs-auto-close="outside"
                aria-expanded="false"
              >
                <i class="fa fa-shopping-cart"></i>
                <span class="badge rounded-pill bg-success d-none cart-count">
                  3
                  <span class="visually-hidden">number of cart</span>
                </span>
              </a>
              <ul
                class="dropdown-menu bg-dark dropdown-menu-dark"
                aria-labelledby="navbarScrollingDropdown"
              >
                <li class="">
                  <a class="dropdown-item text-center p-2 px-5" href="cart.html"
                    >View Cart</a
                  >
                </li>
                <li class="d-flex">
                  <a
                    class="text-decoration-none w-100 btn-success text-center p-2 px-5"
                    href="checkout.html"
                    >Checkout</a
                  ><a
                    class="text-decoration-none w-100 btn-danger text-center p-2 px-5 cursor-pointer"
                    href="#"
                    onclick="clearCart()"
                    >Clear</a
                  >
                </li>
                <li>
                  <hr class="dropdown-divider" />
                  <div class="w-100 px-3 text-end">
                    Total:
                    <span class="fs-5 fw-bold total-cart-price">0</span> PKR
                  </div>
                </li>
                <li class="p-2">
                  <ol
                    class="list-group"
                    style="max-height: 50vh; overflow-y: auto"
                    id="cart-items"
                  ></ol>
                </li>
              </ul>
            </li>

            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="index.html">Home</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="menu.html">Menu</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="branches.html">Branches</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="order.html">My Order</a>
            </li>
          </ul>
          <span class="navbar-text"> </span>
        </div>
      </div>
    </nav>

    <div class="main nav-scroller">
      <!-- show multiple receipt page -->
      <!-- demo order card -->
      <div class="container">
        <!-- Track Order -->
        <div class="row">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Get Order Status</h4>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-12">
                    <!-- prepend bootstrap -->
                    <div class="input-group mb-3">
                      <div class="input-group-prepend">
                        <label for="ref-id"
                        class="form-control fw-bold">
                      Reference ID</label>
                      </div>
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Order ID"
                        aria-label="Order ID"
                        aria-describedby="basic-addon1"
                        id="ref-id"
                        onkeypress="if(event.keyCode==13) getStatus()"
                      />
                      <button
                      class="append btn btn-success" onclick="getStatus()">Get Status</button>
                      </div>

                  </div>
                  <!-- Your order on the way -->
                  <div class="result">
                    
                  </div>
                </div>
              </div>
            </div>
          </div>
          </div>

          <!-- Our phone number and whatsapp  -->
          



      </div>
    </div>
   <footer class="bg-dark text-white mt-2 pt-2 pb-1">
      <div class="container">
        <div class="row">
          <div class="col-7 col-md-9">
            <div class="row">
              <div class="col-md-4 d-flex">
                <span class="fs-5 fw-bold text-secondary mt-auto mb-auto">WhitesCastle</span>
              </div>
              <div class="col-md-8 d-flex">
                <span class="links ms-auto me-auto">
                  <a href="https://www.facebook.com/whites.castle.amir/" class="col fs-3 m-2 text-white opacity-hover"><i class="fab fa-facebook"></i></a>
                  <a href="https://wa.me/923041115959" class="col fs-3 m-2 text-white opacity-hover"><i class="fab fa-whatsapp"></i></a>
                  <a href="https://apps.apple.com/pk/app/whites-castle/id1573628371" class="col fs-3 m-2 text-white opacity-hover"><i class="fab fa-apple"></i></a>
                  <a href="https://play.google.com/store/apps/details?id=com.whitescastle" class="col fs-3 m-2 text-white opacity-hover"><i class="fab fa-android"></i></a>
                </span>
              </div>
            </div>
          </div>
          <div class="col-5 col-md-3 d-flex">
            <div class="row">
              <div class="col-md-8 d-flex">
                <span class="text-secondary mt-auto mb-auto ms-auto">Developed by</span>
              </div>
              <div class="col-md-4 d-flex">
                <a href="http://hamza8bit.github.io" class="fw-bold text-white opacity-hover ms-auto mt-auto mb-auto">Hamza8bit</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <div id="toast">
      <div id="img">Icon</div>
      <div id="desc">A notification message..</div>
    </div>
  </body>
  <script src="cart.js"></script>
  <script>
    "use strict";
    function myScript() {

      initializeComponents();
      //fetch login status
      
    }
    function getStatus(){
      //get input
      var refId = document.getElementById('ref-id').value;
      //check if input is empty
      if(refId == ''){
        launch_toast(
          //cross unicode
          '&#x274C;',
           'Please enter your reference ID');
           return
      }
      //show loading at result
      document.querySelector('.result').innerHTML = '<span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span> <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>';
      fetch(servers.api+"/orders/orderstatus/"+refId, {
        headers: {
          //token
          Authorization: "Bearer " + localStorage.getItem("token"),
        },
      }).then(
        function (response) {
          if(response.status == 404){
            //order not found
            launch_toast("X", "Order not found");
            return false;
          }
          if(response.status != 200)
          {
            //error
            launch_toast("X", "Error");
            return false;
          }
          else return response.json()
        }).then(order=>{
          if(!order){
            //throw error
            
            launch_toast("X", "Order not found");
            return false;
          }

          let status = "Pending";
                  if (order.Cancelled)
                    status = "Cancelled";
                  else if (order.OrderDelivered) status = "Delivered";
                  else if (order.RiderHandOver) status = "On The Way";
                  else if (order.OrderPreparing) status = "Preparing";
                  else if (order.OrderReceived) status = "Picked";
          
          let html = '';
          switch(status){
            case "Pending":
              html += `<p class="text text-secondary">Your Order# ${order.RefID} is pending, <a href="receipt.html#${order.RefID}">View Receipt</a></p>`;
              break;
            case "Pending":
              html += `<p class="text text-success">Your Order# ${order.RefID} is picked, <a href="receipt.html#${order.RefID}">View Receipt</a></p>`;
              break;
            case "Cancelled":
              html += `<p class="text text-danger">Your Order# ${order.RefID} is cancelled, <a href="receipt.html#${order.RefID}">View Receipt</a></p>`;
              break;
            case "Delivered":
              html += `<p class="text text-success">Your Order# ${order.RefID} is delivered, <a href="receipt.html#${order.RefID}">View Receipt</a></p>`;
              break;
            case "On The Way":
              html += `<p class="text text-success">Your Order# ${order.RefID} is on the way, <a href="receipt.html#${order.RefID}">View Receipt</a></p>`;
              break;
            case "Preparing":
              html += `<p class="text text-primary">Your Order# ${order.RefID} is preparing, <a href="receipt.html#${order.RefID}">View Receipt</a></p>`;
              break;
            default:
                html += `<p class="text text-danger">Your Order# ${order.RefID} is not found.</p>`;
          };
          document.querySelector(".result").innerHTML = html;


        }).catch(error=>{
            document.querySelector(".result").innerHTML = `<p class="text text-danger">Order against Ref# ${refId} is not found.</p>`;
        });
    }
  </script>
</html>
